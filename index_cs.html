<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <title>Socket IO Chat App</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
        <link rel="stylesheet" href="css/styles.css">
    </head>
    <body>
        <!--
        <nav class="navbar navbar-dark bg-dark">
            <div class="container">
                <a class="navbar-brand" href="#">
                <img src="css/752680.svg" width="30" height="30" class="d-inline-block align-top" alt="" loading="lazy">
                Socket.io Proof of Concept
                </a>
            </div>
          </nav>
        <div class="container">
            <div>
                

            </div>
        </div>
    -->
    <input type="hidden" id="current_user_id" value="74">
        <nav class="navbar navbar-dark sticky-top bg-dark flex-md-nowrap p-0 shadow">
      <a class="navbar-brand col-md-3 col-lg-2 mr-0 px-3" href="#">Company name</a>
      <button class="navbar-toggler position-absolute d-md-none collapsed" type="button" data-toggle="collapse" data-target="#sidebarMenu" aria-controls="sidebarMenu" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <input class="form-control form-control-dark w-100" type="text" placeholder="Search" aria-label="Search">
      <ul class="navbar-nav px-3">
        <li class="nav-item text-nowrap">
          <a class="nav-link" href="#">Sign out</a>
        </li>
      </ul>
    </nav>
    <span class="dropdown span"><span class="dropdown-toggle" data-toggle="dropdown" href="#"><a id="menubar_item_right_Charles" class="userName textOverflowEllipsis" title="Jennifer"><strong>Jennifer</strong>&nbsp;<i class="caret"></i> </a> </span><ul class="dropdown-menu pull-right"><li><a target="" id="menubar_item_right_LBL_MY_PREFERENCES" href="index.php?module=Users&amp;view=PreferenceDetail&amp;record=74">My Preferences</a></li><li class="divider">&nbsp;</li><li><a target="" id="menubar_item_right_LBL_SIGN_OUT" href="?module=Users&amp;parent=Settings&amp;action=Logout">Sign Out</a></li></ul></span>
    <div class="container-fluid">
      <div class="row">
        <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block bg-light sidebar collapse">
          <div class="sidebar-sticky pt-3">
            <ul class="nav flex-column">
              <li class="nav-item">
                <a class="nav-link active" href="#">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-home"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
                  Dashboard <span class="sr-only">(current)</span>
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline></svg>
                  Orders
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-shopping-cart"><circle cx="9" cy="21" r="1"></circle><circle cx="20" cy="21" r="1"></circle><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path></svg>
                  Products
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-users"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
                  Customers
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-bar-chart-2"><line x1="18" y1="20" x2="18" y2="10"></line><line x1="12" y1="20" x2="12" y2="4"></line><line x1="6" y1="20" x2="6" y2="14"></line></svg>
                  Reports
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-layers"><polygon points="12 2 2 7 12 12 22 7 12 2"></polygon><polyline points="2 17 12 22 22 17"></polyline><polyline points="2 12 12 17 22 12"></polyline></svg>
                  Integrations
                </a>
              </li>
            </ul>
    
            <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
              <span>Saved reports</span>
              <a class="d-flex align-items-center text-muted" href="#" aria-label="Add a new report">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-plus-circle"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="16"></line><line x1="8" y1="12" x2="16" y2="12"></line></svg>
              </a>
            </h6>
            <ul class="nav flex-column mb-2">
              <li class="nav-item">
                <a class="nav-link" href="#">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
                  Current month
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
                  Last quarter
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
                  Social engagement
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
                  Year-end sale
                </a>
              </li>
            </ul>
          </div>
        </nav>
    
        <main role="main" class="col-md-9 ml-sm-auto col-lg-10 px-md-4"><div class="chartjs-size-monitor" style="position: absolute; left: 0px; top: 0px; right: 0px; bottom: 0px; overflow: hidden; pointer-events: none; visibility: hidden; z-index: -1;"><div class="chartjs-size-monitor-expand" style="position:absolute;left:0;top:0;right:0;bottom:0;overflow:hidden;pointer-events:none;visibility:hidden;z-index:-1;"><div style="position:absolute;width:1000000px;height:1000000px;left:0;top:0"></div></div><div class="chartjs-size-monitor-shrink" style="position:absolute;left:0;top:0;right:0;bottom:0;overflow:hidden;pointer-events:none;visibility:hidden;z-index:-1;"><div style="position:absolute;width:200%;height:200%;left:0; top:0"></div></div></div>
          <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
            <h1 class="h2">Dashboard</h1>
            <div class="btn-toolbar mb-2 mb-md-0">
              <div class="btn-group mr-2">
                <button type="button" class="btn btn-sm btn-outline-secondary">Share</button>
                <button type="button" class="btn btn-sm btn-outline-secondary">Export</button>
              </div>
              <button type="button" class="btn btn-sm btn-outline-secondary dropdown-toggle">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
                This week
              </button>
            </div>
          </div>
    
          <canvas class="my-4 w-100 chartjs-render-monitor" id="myChart" width="1538" height="649" style="display: block; width: 1538px; height: 649px;"></canvas>
    
          <h2>Section title</h2>
          <div class="table-responsive">
            <table class="table table-striped table-sm">
              <thead>
                <tr>
                  <th>#</th>
                  <th>Header</th>
                  <th>Header</th>
                  <th>Header</th>
                  <th>Header</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>1,001</td>
                  <td>Lorem</td>
                  <td>ipsum</td>
                  <td>dolor</td>
                  <td>sit</td>
                </tr>
                <tr>
                  <td>1,002</td>
                  <td>amet</td>
                  <td>consectetur</td>
                  <td>adipiscing</td>
                  <td>elit</td>
                </tr>
                <tr>
                  <td>1,003</td>
                  <td>Integer</td>
                  <td>nec</td>
                  <td>odio</td>
                  <td>Praesent</td>
                </tr>
                <tr>
                  <td>1,003</td>
                  <td>libero</td>
                  <td>Sed</td>
                  <td>cursus</td>
                  <td>ante</td>
                </tr>
                <tr>
                  <td>1,004</td>
                  <td>dapibus</td>
                  <td>diam</td>
                  <td>Sed</td>
                  <td>nisi</td>
                </tr>
                <tr>
                  <td>1,005</td>
                  <td>Nulla</td>
                  <td>quis</td>
                  <td>sem</td>
                  <td>at</td>
                </tr>
                <tr>
                  <td>1,006</td>
                  <td>nibh</td>
                  <td>elementum</td>
                  <td>imperdiet</td>
                  <td>Duis</td>
                </tr>
                <tr>
                  <td>1,007</td>
                  <td>sagittis</td>
                  <td>ipsum</td>
                  <td>Praesent</td>
                  <td>mauris</td>
                </tr>
                <tr>
                  <td>1,008</td>
                  <td>Fusce</td>
                  <td>nec</td>
                  <td>tellus</td>
                  <td>sed</td>
                </tr>
                <tr>
                  <td>1,009</td>
                  <td>augue</td>
                  <td>semper</td>
                  <td>porta</td>
                  <td>Mauris</td>
                </tr>
                <tr>
                  <td>1,010</td>
                  <td>massa</td>
                  <td>Vestibulum</td>
                  <td>lacinia</td>
                  <td>arcu</td>
                </tr>
                <tr>
                  <td>1,011</td>
                  <td>eget</td>
                  <td>nulla</td>
                  <td>Class</td>
                  <td>aptent</td>
                </tr>
                <tr>
                  <td>1,012</td>
                  <td>taciti</td>
                  <td>sociosqu</td>
                  <td>ad</td>
                  <td>litora</td>
                </tr>
                <tr>
                  <td>1,013</td>
                  <td>torquent</td>
                  <td>per</td>
                  <td>conubia</td>
                  <td>nostra</td>
                </tr>
                <tr>
                  <td>1,014</td>
                  <td>per</td>
                  <td>inceptos</td>
                  <td>himenaeos</td>
                  <td>Curabitur</td>
                </tr>
                <tr>
                  <td>1,015</td>
                  <td>sodales</td>
                  <td>ligula</td>
                  <td>in</td>
                  <td>libero</td>
                </tr>
              </tbody>
            </table>
          </div>
        </main>
      </div>
    </div>
    <div class="dropdown">
      <div class="button-holder" style="position: fixed;bottom: 20px;right: 30px;z-index: 99;z-index: 1000;">
          <button type="button" class="btn btn-info btn-lg" style="border-radius:50%;" onclick="openChat();" id="chat-button">
              <div class="chat-bubble-div" style="padding: 5px 2px;">
                <svg focusable="false" fill="#fff" aria-hidden="true" viewBox="0 0 28 32" width="28" height="32"><path d="M28,32 C28,32 23.2863266,30.1450667 19.4727818,28.6592 L3.43749107,28.6592 C1.53921989,28.6592 0,27.0272 0,25.0144 L0,3.6448 C0,1.632 1.53921989,0 3.43749107,0 L24.5615088,0 C26.45978,0 27.9989999,1.632 27.9989999,3.6448 L27.9989999,22.0490667 L28,22.0490667 L28,32 Z M23.8614088,20.0181333 C23.5309223,19.6105242 22.9540812,19.5633836 22.5692242,19.9125333 C22.5392199,19.9392 19.5537934,22.5941333 13.9989999,22.5941333 C8.51321617,22.5941333 5.48178311,19.9584 5.4277754,19.9104 C5.04295119,19.5629428 4.46760991,19.6105095 4.13759108,20.0170667 C3.97913051,20.2124916 3.9004494,20.4673395 3.91904357,20.7249415 C3.93763774,20.9825435 4.05196575,21.2215447 4.23660523,21.3888 C4.37862552,21.5168 7.77411059,24.5386667 13.9989999,24.5386667 C20.2248893,24.5386667 23.6203743,21.5168 23.7623946,21.3888 C23.9467342,21.2215726 24.0608642,20.9827905 24.0794539,20.7254507 C24.0980436,20.4681109 24.0195551,20.2135019 23.8614088,20.0181333 Z"></path></svg>
              </div>
          </button>
      </div>
      <div class="">
          <div class="card" id="chat-widget" style="width: 20rem;position: fixed;bottom: 20px;right: 30px;z-index: 99;z-index: 1000; min-height: 30rem;box-shadow: 0 5px 25px 0 rgba(0,0,0,.30); display: none;"> 
              <div class="card-header text-white bg-info">
                  <div class="container row mx-0 px-0">
                      <div id="rep-name" style="width: max-content">Awaiting Chat...</div>
                      <div class="ml-auto float-right">
                        <a class="btn btn-light btn-sm" onclick="clearChat()">Clear Chat</a> &nbsp;
                      </div>
                      <div class="float-right" style="padding-right: 8px;">
                        <a type="button" class="float-right" style="align-self: center;" onclick="minimizeChat()">
                          <i class="flex" style="display:flex; align-items:center; justify-content:center;">
                            <svg viewBox="0.044 7.5 16 2" width="18" height="30" style="fill:white">
                              <path fill-rule="evenodd" d="M 0.044 8 C 0.044 7.724 0.492 7.5 1.044 7.5 L 15.041 7.5 C 15.813 7.5 16.293 7.917 15.909 8.25 C 15.729 8.405 15.4 8.5 15.041 8.5 L 1.044 8.5 C 0.492 8.5 0.044 8.276 0.044 8 Z" style="fill: white;stroke-width: 23px;" data-bx-origin="0.499978 0.5"></path>
                            </svg>
                          </i>
                        </a>
                      </div>
                        <a type="button" class="" style="align-self: center;" onclick="closeChat()">
                            <i class="flex" style="display: flex; align-items: center; justify-content: center;">
                                <svg style="fill: white;" width="17" height="17" viewBox="0 0 17 17" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M9.502 8.5l7.29 7.29c.277.278.277.727 0 1.003-.137.138-.32.207-.5.207s-.362-.07-.5-.207L8.5 9.503l-7.29 7.29c-.14.138-.32.207-.5.207-.183 0-.364-.07-.502-.207-.277-.276-.277-.725 0-1.002l7.29-7.29-7.29-7.29C-.07.932-.07.483.208.206c.277-.276.725-.276 1 0L8.5 7.497l7.29-7.29c.277-.276.725-.276 1.002 0 .277.277.277.726 0 1.002L9.502 8.5z" fill-rule="evenodd"></path>
                                </svg>
                            </i>
                        </a>
                  </div>
              </div>
              <div class="card-body">
                <div id="clear-modal" style="width: 87%;height: 75%;z-index: 50;background-color: rgba(0,0,0, 80%);position: absolute;margin: 0;padding: 0;visibility:hidden">
                  <p style="color: white;position: relative;top: 50%;text-align: center;">Are you sure you want to clear the chat?</p>
                  <div style="position: relative;top: 50%;text-align: center;">
                    <a class="btn btn-secondary" onclick="clearChatConfirm();">Yes</a> &nbsp;<a class="btn btn-secondary" onclick="clearChatDecline();">No</a>
                  </div>
                </div>
                <div id="disconnect-modal" style="width: 87%;height: 75%;z-index: 50;background-color: rgba(0,0,0, 80%);position: absolute;margin: 0;padding: 0;visibility:hidden">
                  <p style="color: white;position: relative;top: 50%;text-align: center;">This will disconnect you from the Chat session, are you sure?</p>
                  <div style="position: relative;top: 50%;text-align: center;">
                      <a class="btn btn-secondary" onclick="disconnectChat();">Yes</a> &nbsp;<a class="btn btn-secondary" onclick="keepChatConnected();">No</a>
                  </div>
                </div>
                  <div id="message-date" style="text-align: center; color: rgb(0 0 0 / 50%);">DAY 00:00AM</div>
                  <div id="conversation-body" style="max-height: 20rem; overflow: auto;">
                     
                  </div>
                  <div id="typing-notif" style="text-align: center;color: rgb(0 0 0 / 50%);visibility: hidden;">Someone is typing...</div>
              </div>
              <form action="" id="message-form">
                  <div id="conversation-input" class="input-group input-group-md" style="box-shadow: 0 5px 25px 0 rgba(0,0,0,.30)">
                      <input id="input-message" type="text" class="form-control" autocomplete="off" placeholder="Enter your message here..." aria-label="message">
                      <div class="input-group-append">
                          <button class="btn btn-outline-info" type="Submit">Send</button>
                      </div>
                  </div>
              </form>
          </div>
      </div>
  </div>
</div>
        <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/feather-icons/4.9.0/feather.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.3/Chart.min.js"></script>
        <script src="js/dashboard.js"></script>
        <script type="text/javascript" src="js/socket.io.js"></script>
        <script>
           var current_user_id = document.getElementById('current_user_id').value;
            var userName = document.getElementsByClassName('userName')[0].title;
            const messagediv = document.getElementById('conversation-body');
            var typing = false;
            var timeout;
            var message_history;
            var socket = io.connect('http://localhost:8084');
            socket.on('connect', function () {
                try{
                  message_history = localStorage.getItem('message_history');
                }catch(err){
                  console.log('No message history or previous room', err);
                }
                if(message_history){
                  openChat();
                }
                socket.send('chat supervisor connected to server');
                socket.on('message', function (msg) {
                    console.log(msg);
                });
                socket.emit('create_room', current_user_id);
                socket.on('chat_message_received', function(message, c_u_id){
                    var today = new Date();
                    var minutes = today.getMinutes();
                    var hours = today.getHours();
                    var ampm = hours >= 12 ? 'PM' : 'AM';
                    hours = hours % 12;
                    hours = hours ? hours : 12;
                    if (minutes < 10){
                      minutes = '0' + minutes;
                    }
                    var time = today.getHours() + ":" + minutes;
                    console.log('chat message received', message);
                    if(c_u_id == userName){
                      $("#conversation-body").append($('<p class="bg-info text-white border-info" style="margin-left: auto;margin-bottom:0px;border: 2px solid lightgrey;border-radius: 1rem;padding: 5px 15px;width: max-content;background-color: lightgrey;color: black;white-space: unset;overflow: auto;overflow-wrap: anywhere;max-width: 100%;">').text(message)) //.append('<strong> :You</strong>'));
                        $("#conversation-body").append($('<p style="text-align:right;margin-bottom:0px;color: grey;">').text(c_u_id + ' ' + time + ampm));
                    }else{
                        $("#conversation-body").append($('<p class="bg-secondary text-white border-secondary" style="margin-bottom:0px;border: 2px solid lightgrey;border-radius: 1rem;padding: 5px 15px;width: max-content;background-color: lightgrey;color: black;white-space: unset;overflow: auto;overflow-wrap: anywhere;max-width: 100%;">').text(message)) //.append('<strong> :You</strong>'));
                        $("#conversation-body").append($('<p style="margin-bottom:0px;color: grey;">').text(c_u_id + ' ' + time + ampm));
                    }
                    var shouldScroll = messagediv.scrollTop + messagediv.clientHeight !== messagediv.scrollHeight;
                    if (shouldScroll){
                        scrollToBottom();
                    }
                    message_history = messagediv.innerHTML;
                    localStorage.setItem('message_history', message_history);
                })
                socket.on('user_joined', function(user, user_id, roomId, fresh){
                  if(user_id == userName){
                    $("#conversation-body").append($('<p style="color: rgb(0 0 0 / 50%);text-align: center;margin-bottom: 0;">').text('You have joined a chat supervisor\'s room'));
                    document.getElementById('rep-name').innerHTML = "Connected";
                  }else{
                    if(fresh === true){
                      $("#conversation-body").append($('<p style="color: rgb(0 0 0 / 50%);text-align: center;margin-bottom: 0;">').text(user_id + ' has joined the room'));
                    }
                    document.getElementById('rep-name').innerHTML = "Connected";
                    var shouldScroll = messagediv.scrollTop + messagediv.clientHeight !== messagediv.scrollHeight;
                    if (shouldScroll){
                        scrollToBottom();
                    }
                  }
                })
                socket.on('user_left', function(user, user_id){
                  $("#conversation-body").append($('<p style="color: rgb(0 0 0 / 50%);text-align: center;margin-bottom: 0;">').text(user_id + ' has left the room'));
                    document.getElementById('rep-name').innerHTML = "Awaiting Chat...";
                    var shouldScroll = messagediv.scrollTop + messagediv.clientHeight !== messagediv.scrollHeight;
                    if (shouldScroll){
                        scrollToBottom();
                    }
                })
                socket.on('display_typing', function(status, user_id){
                  var typing_notif = document.getElementById('typing-notif');
                  if(status == true){
                    if(user_id == userName){
                    }else{
                      typing_notif.innerHTML = user_id + ' is typing...'
                      typing_notif.style.visibility = "visible";
                    }
                  }else{
                    typing_notif.style.visibility = 'hidden';
                  }
                })
            }); 
            $('#input-message').keypress((e) =>{ 
              if(e.which != 13){
                typing = true;
                socket.emit('typing', true, userName);
                clearTimeout(timeout)
                timeout = setTimeout(function(){
                  typing = false;
                  socket.emit('typing', false, userName);
                }, 1500)
              }else{
                clearTimeout(timeout)
                typing = false
                socket.emit('typing', false, userName);
              }
            })
            function openChat(){
              try{
                message_history = localStorage.getItem('message_history');
              }catch(err){
                console.log('No message history or previous room', err);
              }
              if(message_history){
                messagediv.innerHTML = message_history;
              }
              updateDate();
              document.getElementById('chat-button').style.display = "none";
              document.getElementById('chat-widget').style.display = "flex";
              var shouldScroll = messagediv.scrollTop + messagediv.clientHeight !== messagediv.scrollHeight;
              if (shouldScroll){
                  scrollToBottom();
              }
            }
            function minimizeChat(){
              document.getElementById('chat-button').style.display = "inline-block";
              document.getElementById('chat-widget').style.display = "none";
            }
            function closeChat(){
                /*
                document.getElementById('chat-button').style.display = "inline-block";
                document.getElementById('chat-widget').style.display = "none";
                */
                /*
                try{
                  localStorage.removeItem('message_history');
                  messagediv.innerHTML = '';
                }catch(err){
                  console.log('failed to remove history', err);
                }
                */
            } 

            function closeChat(){
              document.getElementById('disconnect-modal').style.visibility="visible";
            }
            function disconnectChat(){
                socket.emit('leave_room', userName);
          //socket.emit('kick_users');
          //socket.emit('destroy_room', user_id);
                document.getElementById('disconnect-modal').style.visibility="hidden";
                $("#conversation-body").append($('<p style="color: rgb(0 0 0 / 50%);text-align: center;margin-bottom: 0;">').text('You have gone offline. Please reopen the chat window to restart your session.'));
                document.getElementById('rep-name').innerHTML = "Disconnected";
            }
            function keepChatConnected(){
                document.getElementById('disconnect-modal').style.visibility="hidden";
            }
            function clearChat(){
                document.getElementById("clear-modal").style.visibility="visible";
            }
            function clearChatConfirm(){
                document.getElementById("clear-modal").style.visibility="hidden";
                messagediv.innerHTML="";
                try{
                        localStorage.removeItem('message_history');
                }catch(err){
                        console.log('clear failed', err);
                }
                updateDate();
            }
            function clearChatDecline(){
                document.getElementById("clear-modal").style.visibility="hidden";
                updateDate();
            }
            $('#message-form').submit(function(e){
                e.preventDefault();
                socket.emit('chat_message', $('#input-message').val(), userName);
                $('#input-message').val('');
                return false;
            })
            function scrollToBottom(){
              messagediv.scrollTop = messagediv.scrollHeight;
            }
            function updateDate(){
              var d = new Date();
              var weekday = new Array(7);
              var hours = d.getHours();
              var ampm = hours >= 12 ? 'PM' : 'AM';
              hours = hours % 12;
              hours = hours ? hours : 12;
              weekday[0] = "SUN";
              weekday[1] = "MON";
              weekday[2] = "TUES";
              weekday[3] = "WED";
              weekday[4] = "THURS";
              weekday[5] = "FRI";
              weekday[6] = "SAT";
              var minutes = d.getMinutes();
              if (minutes < 10){
                minutes = '0' + minutes;
              }
              var time = d.getHours() + ":" + minutes;

              var n = weekday[d.getDay()];
              document.getElementById('message-date').innerHTML = n + ' ' + time + ampm;
            }
        </script>
    </body>
</html>